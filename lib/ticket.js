!function(t){function e(r){if(n[r])return n[r].exports;var o=n[r]={i:r,l:!1,exports:{}};return t[r].call(o.exports,o,o.exports,e),o.l=!0,o.exports}var n={};return e.m=t,e.c=n,e.i=function(t){return t},e.d=function(t,n,r){e.o(t,n)||Object.defineProperty(t,n,{configurable:!1,enumerable:!0,get:r})},e.n=function(t){var n=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(n,"a",n),n},e.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},e.p="",e(e.s=16)}([function(t,e,n){"use strict";function r(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0}),e.formatRow=e.getStationName=e.isString=void 0;var o=n(2),u=r(o),a=void 0,i=e.isString=function(t){return"string"==typeof t};e.getStationName=function(t){return a||(a=n(12)),a[t]},e.formatRow=function(t){return[t.station_train_code,[u.default.yellow(t.from_station_name),u.default.green(t.to_station_name)].join("->"),[u.default.yellow(t.start_time),u.default.green(t.arrive_time)].join("->"),t.lishi,t.zy_num,t.ze_num,t.rw_num,t.yw_num,t.yz_num,i(t.note)?t.note.replace("月","/").replace("点",":").replace(/分|起|售|日/g,"").replace("<br/>"," "):""]}},function(t,e,n){"use strict";function r(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0});var o=n(4),u=r(o),a=n(3),i=r(a),f=n(0),s=function(t,e,n){return new i.default(function(r,o){var a=(0,f.getStationName)(t),i=(0,f.getStationName)(e);if(!a)return void o({msg:"出发站代码未找到",data:null});if(!i)return void o({msg:"到站代码未找到",data:null});var s="https://kyfw.12306.cn/otn/leftTicket/queryZ?leftTicketDTO.train_date="+n+"&leftTicketDTO.from_station="+a+"&leftTicketDTO.to_station="+i+"&purpose_codes=ADULT";console.log("requesting tickets(from: %s, to: %s, date: %s)",t,e,n),console.log(s),u.default.get({uri:s,rejectUnauthorized:!1},function(u,a,i){if(u)return void o({msg:"获取车票信息失败",data:u});var f=JSON.parse(i),s={searchDate:n,datas:f.data.map(function(t){var e=t.queryLeftNewDTO;return e})};r(s,{from:t,to:e,date:n})})})};e.default=s},function(t,e){t.exports=require("chalk")},function(t,e){t.exports=require("es6-promise")},function(t,e){t.exports=require("request")},function(t,e,n){"use strict";function r(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0}),e.refresh=void 0;var o=n(4),u=r(o),a=n(14),i=r(a),f=n(3),s=r(f),c=n(15),l=r(c),d=l.default.resolve("data","stationNames.json"),p=function(t){return new s.default(function(e,n){return i.default.stat(t,function(r,o){r?i.default.mkdir(t,function(t){return t?n(t):e()}):e()})})},_=function(t){return new s.default(function(e,n){return u.default.get({uri:"https://kyfw.12306.cn/otn/resources/js/framework/station_name.js?station_version=1.8968",rejectUnauthorized:!1},function(r,o,u){if(r)return n(r);for(var a=/([A-Z]+)\|([a-z]+)/g,f={},s=void 0;s=a.exec(u);)f[s[2]]=s[1];i.default.writeFile(t,JSON.stringify(f),function(t){return t?n(t):e()})})})};e.refresh=function(){return p(l.default.dirname(d)).then(function(){return _(d)})}},function(t,e,n){"use strict";function r(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0});var o=n(1),u=r(o),a=n(10),i=function(t,e,n,r){(0,u.default)(t,e,n).then(function(o){var u=o.datas,i=o.searchDate,f=void 0===i?n:i;return(0,a.render)({datas:u,searchDate:f,from:t,to:e,date:n,options:r})}).catch(console.log)};e.default=i},function(t,e){t.exports=require("commander")},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=function(t,e){var n=t.options.allowTrainTypes||[];n.length>0&&(t.datas=t.datas.filter(function(t){return n.indexOf(t.station_train_code[0].toLocaleLowerCase())!==-1})),e()};e.default=r},function(t,e,n){"use strict";function r(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0});var o=n(0),u=n(1),a=r(u),i=function(t){var e=(0,o.formatRow)(t.throughInfo);return e[0]="",(0,o.formatRow)(t).map(function(t,n){return t+"\n"+e[n]})},f=function(t,e){var n=e.map(function(t){return t.train_no});return t.filter(function(t){var r=n.indexOf(t.train_no);return r!==-1&&(t.throughInfo=e[r],!0)})},s=function(t,e){var n=t.options,r=t.from,u=t.date;n.formatRow=n.hasThrough?i:o.formatRow,n.hasThrough?(0,a.default)(r,n.through,u).then(function(n){var r=n.datas;return t.datas=f(t.datas,r),e(),t.datas}).catch(function(t){return console.error(t)}):e()};e.default=s},function(t,e,n){"use strict";function r(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0}),e.render=void 0;var o=n(8),u=r(o),a=n(9),i=r(a),f=n(11),s=r(f),c=[u.default,i.default,s.default],l=function(t){var e=this,n=0,r=function r(){var o=c[n++];if(o)try{o.call(e,t,r)}catch(t){console.error(t)}};r()};e.render=l},function(t,e,n){"use strict";function r(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0});var o=n(13),u=r(o),a=n(2),i=r(a),f=n(0),s=function(t,e){var n=t.datas,r=t.searchDate,o=t.from,a=t.to,s=t.options,c=new u.default({head:"车次 出发/到达站 出发/到达时间 历时 一等坐 二等坐 软卧 硬卧 硬座 起售".split(" ")});c.push.apply(c,n.map(s.formatRow||f.formatRow));var l=s.allowTrainTypes.join(",");console.log(c.toString()),console.log("  %s -> %s %s 共计%d个车次 %s",o,a,i.default.bold.red("("+r.replace(/&nbsp;/g," ")+")"),n.length,l?"筛选类型: "+l:""),e()};e.default=s},function(t,e){t.exports=require("/home/xsp/src/js/tickets/data/stationNames")},function(t,e){t.exports=require("cli-table2")},function(t,e){t.exports=require("fs")},function(t,e){t.exports=require("path")},function(t,e,n){"use strict";function r(t){return t&&t.__esModule?t:{default:t}}var o=n(7),u=r(o),a=n(5),i=n(6),f=r(i);u.default.description("查询12306车票信息,可筛选过站.\n  eg: ticket beijing hangzhou 2017-02-28").arguments("<from> <to> <date>").option("-g, --gao","高铁").option("-d, --dong","动车").option("-t, --te","特快").option("-k, --kuai","快速").option("-z, --zhi","直达").option("--through <station name>","途径站").action(function(t,e,n){var r=["gao","dong","te","kuai","zhi"].filter(function(t){return t in u.default}).map(function(t){return t[0].toLocaleLowerCase()});(0,a.refresh)().then(function(){(0,f.default)(t,e,n,{allowTrainTypes:r,through:u.default.through,hasThrough:!!u.default.through})}).catch(console.error)}).version("1.0.0").parse(process.argv)}]);